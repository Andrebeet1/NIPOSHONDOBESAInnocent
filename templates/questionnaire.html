{% extends "base.html" %}

{% block title %}Questionnaire{% endblock %}

{% block content %}
<style>
/* ======== STYLE MODERNE TYPE CHATGPT ======== */
body {
  background: #f9fafb;
  font-family: 'Inter', 'Segoe UI', sans-serif;
  color: #111827;
}

.container-form {
  max-width: 850px;
  margin: 3rem auto;
  background: white;
  border-radius: 18px;
  box-shadow: 0 4px 25px rgba(0,0,0,0.06);
  padding: 2.5rem;
  transition: all 0.3s ease;
}

.container-form:hover {
  box-shadow: 0 8px 35px rgba(0,0,0,0.08);
}

h2 {
  text-align: center;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 1rem;
}

p.intro {
  color: #6b7280;
  text-align: center;
  margin-bottom: 2rem;
  font-size: 15px;
}

/* Section */
.section {
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 14px;
  margin-bottom: 1.8rem;
  transition: all 0.3s ease;
}
.section:hover {
  background: #f1f5f9;
}

/* Titres des sections */
.section-title {
  font-size: 1.15rem;
  font-weight: 600;
  margin-bottom: 1.2rem;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 0.4rem;
  color: #2563eb;
}

/* Champs de formulaire */
.form-control, .form-select, textarea {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 10px 14px;
  width: 100%;
  background: #f9fafb;
  transition: all 0.2s ease;
}
.form-control:focus, .form-select:focus, textarea:focus {
  border-color: #2563eb;
  background: white;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
  outline: none;
}

/* Label */
label.form-label {
  font-weight: 500;
  color: #374151;
  margin-bottom: 6px;
}

/* Checkbox */
input[type="checkbox"] {
  accent-color: #2563eb;
  margin-right: 5px;
}

/* Bouton principal */
.btn-submit {
  width: 100%;
  padding: 12px;
  font-weight: 600;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 12px;
  transition: background 0.2s ease, transform 0.1s ease;
}
.btn-submit:hover {
  background: #1d4ed8;
  transform: scale(1.02);
}

/* Alertes */
.alert {
  border-radius: 12px;
  font-size: 0.95rem;
}
</style>

<div class="container-form">
  <h2>ü©∫ Questionnaire d‚ÄôEnqu√™te - Zone de Sant√© d‚ÄôIbanda</h2>
  <p class="intro">
    Ce questionnaire vise √† collecter des donn√©es fiables pour identifier les probl√®mes sanitaires,
    orienter la planification locale et soutenir les d√©cisions de sant√© publique.
  </p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show mt-2" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form id="questionnaireForm" class="needs-validation" novalidate>
    <!-- ================== I. Caract√©ristiques sociod√©mographiques ================== -->
    <div class="section">
      <h4 class="section-title">I. Caract√©ristiques sociod√©mographiques</h4>

      <div class="mb-3">
        <label class="form-label">Adresse :</label>
        <input type="text" class="form-control" name="address" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Sexe :</label>
        <select class="form-select" name="gender" required>
          <option value="">-- S√©lectionner --</option>
          <option value="F√©minin">F√©minin</option>
          <option value="Masculin">Masculin</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Statut matrimonial :</label>
        <select class="form-select" name="marital_status" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Mari√©(e)">Mari√©(e)</option>
          <option value="C√©libataire">C√©libataire</option>
          <option value="Divorc√©(e)">Divorc√©(e)</option>
          <option value="Veuf(ve)">Veuf(ve)</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Religion :</label>
        <select class="form-select" name="religion" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Catholique">Catholique</option>
          <option value="Protestant(e)">Protestant(e)</option>
          <option value="Musulman(e)">Musulman(e)</option>
          <option value="T√©moin de J√©hovah">T√©moin de J√©hovah</option>
          <option value="Kimbanguiste">Kimbanguiste</option>
        </select>
      </div>
    </div>

    <!-- ================== II. Connaissance de la population ================== -->
    <div class="section">
      <h4 class="section-title" style="color:#f59e0b;">II. Connaissance de la population</h4>

      <div class="mb-3">
        <label class="form-label">Avez-vous d√©j√† entendu parler des maladies d‚Äôorigine hydrique ?</label>
        <select class="form-select" name="heard_about_waterborne_diseases" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Si oui, par quel canal :</label>
        <input type="text" class="form-control" name="info_channel">
      </div>

      <div class="mb-3">
        <label class="form-label">Connaissance des traitements de l‚Äôeau :</label>
        <select class="form-select" name="know_water_treatment" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </div>
    </div>

    <!-- ================== III. Recours aux mesures ================== -->
    <div class="section">
      <h4 class="section-title" style="color:#16a34a;">III. Recours aux mesures</h4>

      <div class="mb-3">
        <label class="form-label">Source principale d‚Äôeau :</label>
        <input type="text" class="form-control" name="water_supply_source" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Eau trait√©e au point de puisage :</label>
        <select class="form-select" name="water_treatment_at_source" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </div>
    </div>

    <!-- ================== IV. Pr√©valence ================== -->
    <div class="section">
      <h4 class="section-title" style="color:#dc2626;">IV. Pr√©valence</h4>

      <div class="mb-3">
        <label class="form-label">L‚Äôenfant a-t-il d√©j√† contract√© une maladie hydrique :</label>
        <select class="form-select" name="child_waterborne_disease_contact" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Si Oui, laquelle :</label>
        <input type="text" class="form-control" name="disease_name">
      </div>
    </div>

    <button type="submit" class="btn-submit mt-3">Soumettre</button>
  </form>
</div>

<!-- Script AJAX -->
<script>
$(document).ready(function(){
  $('#questionnaireForm').on('submit', function(event){
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "{{ url_for('questionnaire') }}",
      data: $(this).serialize(),
      success: function(){
        var alertHtml = '<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">'
                      + '‚úÖ R√©ponse enregistr√©e avec succ√®s !'
                      + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>'
                      + '</div>';
        $('.container-form').prepend(alertHtml);
        $('#questionnaireForm')[0].reset();
        $('html, body').animate({ scrollTop: 0 }, 'fast');
      },
      error: function(){
        var alertHtml = '<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">'
                      + '‚ùå Erreur lors de l‚Äôenregistrement !'
                      + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>'
                      + '</div>';
        $('.container-form').prepend(alertHtml);
        $('html, body').animate({ scrollTop: 0 }, 'fast');
      }
    });
  });
});
</script>
{% endblock %}
